阅读代码可知，题目要求输入一段文字，使得这段文字经过hash函数计算后的结果，和PASSWD的计算结果一样。

再仔细阅读hash函数代码可以发现，我们输入的文字被分为三段，每一段都是11个字节，然后每一段都会在末尾补上5个0x00，尾部这个值是固定的。同时，AES的密钥是固定的，而且也给出来了，所以我们可以自由地使用AES加密解密。

hash函数的整体思路就是，对第一段进行AES加密运算，得到的结果与第二段进行异或运算，注意**这一步异或运算是不会改变最后5个字节的**。然后，将得到的结果进行AES加密运算，最后再异或第三段，注意**这一步异或运算也是不会改变最后5个字节**。最后输出这个值。

首先，再强调一遍。注意到第三段文字的最后5个字节都是0x00，这样我们可以得知第二次AES加密后的值的**最后5个字节**，这5个字节就是PASSWD的计算结果（h1）的最后5个字节。由于h1是给定的固定值，这5个字节也就是固定且已知的了。

第二，第一次AES加密时，输入的是第一段文字，且最后5个字节是0x00。

第三，第一次AES加密后，下一步是异或第二段文字，且此时第二段文字的最后5个字节也是0x00。因此，**这一步运算不会改变最后5个字节的值**，前文也说到了。由此，我们得知，**第一次AES加密后的值**，和**第二次AES加密前的值**，在**最后5个字节**处是相等的。

题目实际上给定的要求就是上面这些，剩下的其他字节都是可以随便选择的。我们的目标就是构造三段文字，使得其满足上面三点要求。写成式子就是这样：enc(enc(block1) xor block2) xor block3 = h1。

对上面式子调整一下，得到新的形式：enc(block1) xor block2 = dec(h1 xor block3)。题目要求的就是，找到三个新的block，使得它们满足这个关系。但是，现在请注意，这个新的式子里面，**左右两边的结果，最后5个字节的值是相等的**，这一点是**不会受到block2影响**的。也就是说，我们把题目转变成一个稍微简单一点的问题了：找到block1和block3，**使得enc(block1)和dec(h1 xor block3)的最后5个字节是相同的**。

如果我们随机选择block1（最后五个字节是0x00）计算得到enc(block1)，再随机选择block3（最后五个字节是上述第一点得到的值）计算得到dec(h1 xor block3)，那么这两个结果的最后5个字节是有可能会相同的。出现“相同”这件事情我们称之为“碰撞”。而碰撞的概率可以自己算一下。只要这5个字节是相同的，我们就可以进一步计算得到block2了，也就是得到了答案。不过这个概率很低，不太现实。

但是，根据**生日悖论**。。。

先等一下，网上的生日悖论相关文章比较emmm，而且可能大家都没想过可以两个班级，所以我这里简单描述一下，请结合概率论课本理解。随机选择两个班级，数了一下，发现分别有A个同学和B个同学。那么这两个班级之间，有两个同学生日在同一天的概率是很大的。如果期望（数学期望）找到有一对生日相同的同学，则要求A和B的值大概是365的开方。具体怎么算请回去好好学习概率论。

好了，模仿上述思想。如果我们随机选择2^20个block1，计算enc(block1)得到集合1，再随机选择2^20个block3，计算dec(h1 xor block3)得到集合2，那么期望上，我们将会得到一对结果，它们在最后5个字节处是相等的。找到这样一对结果，就相当于找到一对符合题目要求的文字了。剩下的工作就是从block1和block3求解出block2。
